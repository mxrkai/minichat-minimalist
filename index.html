<html><head><base href="https://chatwebsite.example.com/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniChat AI</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body, html {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #e6f2ff; /* Light blue background */
        }
        
        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #e6f2ff; /* Light blue background */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        #chat-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* Space for input container */
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .user-message {
            background-color: #b3d9ff; /* Slightly darker blue for user messages */
            align-self: flex-end;
            margin-left: auto;
        }
        
        .ai-message {
            background-color: #ffffff; /* White background for AI messages */
            align-self: flex-start;
            line-height: 1.6;
        }
        .ai-message p {
            margin: 0 0 10px 0;
        }
        .ai-message pre {
            background-color: #e0e0e0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            position: relative;
        }
        .ai-message code {
            background-color: #e0e0e0;
            padding: 2px 4px;
            border-radius: 2px;
        }
        .ai-message ul, .ai-message ol {
            margin: 0 0 10px 20px;
            padding: 0;
        }
        
        .copy-icon {
            cursor: pointer;
            float: right;
            margin-left: 10px;
            font-size: 14px;
        }

        .code-copy-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 2px 5px;
            font-size: 12px;
        }

        .code-copy-icon:hover {
            background-color: #e0e0e0;
        }

        #input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            padding: 10px;
            background-color: #d1e8ff; /* Light blue for input container */
            border-top: 1px solid #99ccff;
        }
        
        #user-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #99ccff;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #send-button {
            padding: 10px 20px;
            background-color: #4da6ff; /* Darker blue for buttons */
            color: white;
            border: none;
            border-radius: 4px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        #settings-button {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #d1e8ff; /* Light blue for circular buttons */
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
        }

        #clear-chat-button {
            position: fixed;
            top: 60px; /* Positioned below the settings button */
            right: 10px;
            background-color: #d1e8ff; /* Light blue for circular buttons */
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
        }

        #new-conversation-button {
            position: fixed;
            top: 110px; /* Positioned below the clear chat button */
            right: 10px;
            background-color: #d1e8ff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
        }
        
        #settings-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #f0f8ff; /* Very light blue for modal content */
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        .settings-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #99ccff;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        #save-settings {
            padding: 10px 20px;
            background-color: #4da6ff; /* Darker blue for buttons */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .api-key-container {
            display: flex;
            align-items: center;
        }

        #api-key {
            flex-grow: 1;
        }

        #toggle-api-visibility {
            background-color: #d1e8ff; /* Light blue for API visibility button */
            border: none;
            border-radius: 4px;
            padding: 10px;
            margin-left: 10px;
            cursor: pointer;
        }

        #save-api-key-button {
            padding: 5px 10px;
            background-color: #4da6ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        #api-key-switcher-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        #api-key-switcher {
            flex-grow: 1;
            margin-right: 10px;
        }

        #delete-api-key-button {
            padding: 5px 10px;
            background-color: #ff6666;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .toggle-container {
            position: relative;
            width: 60px;
            height: 34px;
            margin: 10px 0;
        }

        .toggle-input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #99ccff;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-label:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-input:checked + .toggle-label {
            background-color: #4da6ff;
        }

        .toggle-input:checked + .toggle-label:before {
            transform: translateX(26px);
        }

        @media (max-width: 600px) {
            .message {
                max-width: 90%;
            }

            #send-button {
                padding: 10px;
            }

            .modal-content {
                width: 95%;
            }
        }

        .modal-content label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .system-prompt-container {
            position: relative;
        }

        #save-prompt-button {
            position: absolute;
            bottom: 5px;
            right: 5px;
            padding: 5px 10px;
            background-color: #4da6ff; /* Darker blue for buttons */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        #clear-prompt-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #888;
        }

        #clear-prompt-button:hover {
            color: #333;
        }

        #prompt-switcher-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        #prompt-switcher {
            flex-grow: 1;
            margin-right: 10px;
        }

        #delete-prompt-button {
            padding: 5px 10px;
            background-color: #ff6666; /* Keep the delete button red for contrast */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .base-url-container {
            display: flex;
            align-items: center;
        }

        #base-url {
            flex-grow: 1;
        }

        #save-base-url-button {
            padding: 5px 10px;
            background-color: #4da6ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        #base-url-switcher-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        #base-url-switcher {
            flex-grow: 1;
            margin-right: 10px;
        }

        #delete-base-url-button {
            padding: 5px 10px;
            background-color: #ff6666;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        #conversation-switcher {
            width: 100%;
        }
        
        #conversation-list {
            list-style-type: none;
            padding: 0;
        }

        .conversation-actions {
            display: flex;
            gap: 5px;
        }

        .rename-conversation, .delete-conversation {
            cursor: pointer;
            padding: 2px 5px;
            background-color: #d1e8ff;
            border: none;
            border-radius: 3px;
        }

        .rename-conversation:hover, .delete-conversation:hover {
            background-color: #b3d9ff;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="chat-container"></div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button id="send-button">Send</button>
        </div>
        <button id="settings-button">⚙️</button>
        <button id="clear-chat-button" title="Clear conversation">🗑️</button>
        <button id="new-conversation-button" title="New conversation">+</button>
    </div>
    
    <div id="settings-modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Settings</h2>
            <label for="api-key">OpenAI API Key:</label>
            <div class="api-key-container">
                <input type="password" id="api-key" class="settings-input" placeholder="Enter your OpenAI API key">
                <button id="toggle-api-visibility">👁️</button>
                <button id="save-api-key-button" class="small-button">Save</button>
            </div>
            <div id="api-key-switcher-container">
                <select id="api-key-switcher" class="settings-input">
                    <option value="">Select a saved API key</option>
                </select>
                <button id="delete-api-key-button" class="small-button" style="display: none;">Delete</button>
            </div>
            <label for="base-url">API Base URL:</label>
            <div class="base-url-container">
                <input type="text" id="base-url" class="settings-input" placeholder="Enter API Base URL">
                <button id="save-base-url-button" class="small-button">Save</button>
            </div>
            <div id="base-url-switcher-container">
                <select id="base-url-switcher" class="settings-input">
                    <option value="">Select a saved Base URL</option>
                    <option value="OpenAI">OpenAI</option>
                    <option value="Groq">Groq</option>
                </select>
                <button id="delete-base-url-button" class="small-button" style="display: none;">Delete</button>
            </div>
            <label for="system-prompt">System Prompt:</label>
            <div class="system-prompt-container">
                <textarea id="system-prompt" class="settings-input" rows="4" placeholder="Enter system prompt"></textarea>
                <button id="save-prompt-button" class="small-button">Save</button>
                <button id="clear-prompt-button" class="small-button" title="Clear prompt">×</button>
            </div>
            <label for="prompt-switcher">Saved Prompts:</label>
            <div id="prompt-switcher-container">
                <select id="prompt-switcher" class="settings-input">
                    <option value="">Select a saved prompt</option>
                    <option value="Concise">Concise</option>
                    <option value="Therapist">Therapist</option>
                    <option value="Babe">Babe</option>
                </select>
                <button id="delete-prompt-button" class="small-button" style="display: none;">Delete</button>
            </div>
            <label for="temperature">Temperature:</label>
            <input type="number" id="temperature" class="settings-input" placeholder="Temperature (0.0 - 1.0)" min="0" max="1" step="0.1">
            <label for="memory-toggle">Memory:</label>
            <div class="toggle-container">
                <input type="checkbox" id="memory-toggle" class="toggle-input" checked>
                <label for="memory-toggle" class="toggle-label"></label>
            </div>
            <label for="model-selector">Model:</label>
            <select id="model-selector" class="settings-input">
                <option value="gpt-4o-mini">gpt-4o-mini</option>
                <option value="gpt-4o">gpt-4o</option>
                <option value="llama3-groq-70b-8192-tool-use-preview">llama3-groq-70b-8192-tool-use-preview</option>
                <option value="gemma-7b-it">gemma-7b-it</option>
                <option value="gemma2-9b-it">gemma2-9b-it</option>
                <option value="llama3-groq-8b-8192-tool-use-preview">llama3-groq-8b-8192-tool-use-preview</option>
                <option value="llama-3.1-70b-versatile">llama-3.1-70b-versatile</option>
                <option value="llama-3.1-8b-instant">llama-3.1-8b-instant</option>
                <option value="llama-guard-3-8b">llama-guard-3-8b</option>
                <option value="llama3-70b-8192">llama3-70b-8192</option>
                <option value="llama3-8b-8192">llama3-8b-8192</option>
                <option value="mixtral-8x7b-32768">mixtral-8x7b-32768</option>
            </select>
            <button id="save-settings">Save Settings</button>
            <h3>Previous Conversations</h3>
            <select id="conversation-switcher" class="settings-input">
                <option value="">Select a conversation</option>
            </select>
            <div id="conversation-actions" style="display: none;">
                <button id="load-conversation-button">Load</button>
                <button id="rename-conversation-button">Rename</button>
                <button id="delete-conversation-button">Delete</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        let savedBaseUrls = {
            "OpenAI": "https://api.openai.com",
            "Groq": "https://api.groq.com/openai"
        };
        let baseUrl = 'https://api.openai.com';
        let defaultSystemPrompt = "Act as a highly-intelligent secretary. Your job is to assist with any information the user asks. Respond in a formal tone. Don't ask questions, just directly reply to the query."
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const settingsButton = document.getElementById('settings-button');
        const settingsModal = document.getElementById('settings-modal');
        const closeButton = document.querySelector('.close');
        const saveSettingsButton = document.getElementById('save-settings');
        const apiKeyInput = document.getElementById('api-key');
        const toggleApiVisibilityButton = document.getElementById('toggle-api-visibility');
        const clearChatButton = document.getElementById('clear-chat-button');
        const newConversationButton = document.getElementById('new-conversation-button');
        const savePromptButton = document.getElementById('save-prompt-button');
        const clearPromptButton = document.getElementById('clear-prompt-button');
        const promptSwitcher = document.getElementById('prompt-switcher');
        const deletePromptButton = document.getElementById('delete-prompt-button');

        let currentConversationName = null;
        let savedPrompts = {
            "Concise": "You are an AI designed to provide short, direct, and factual answers to user queries. Always prioritize relevance and accuracy in your responses. Avoid lengthy explanations or unnecessary details. Respond with only the essential information needed to address the question.",
            "Therapist": "Act as a compassionate and professional counselor. Your job is to provide a safe, empathetic, and non-judgmental space where I can casually and openly vent my feelings, emotions, stresses, anxieties, and problems. Engage with me in a conversational manner, offering support, understanding, and occasional guidance to help me navigate through my challenges. Think as if you're on their situation, weigh it and be straight-forward, dont provide options to choose. Talk in a gangsta tone.",
            "Babe": "Act as a curious 18 year old girlfriend named Ann. You are innocent and wanted to try anything without hesitation. You talk in a casual tone. Always quote your conversation."
        };
        let savedApiKeys = {};
        let savedConversations = {};
        let systemPrompt = "";
        let temperature = 0.7;
        let apiKey = '';
        let model = "gpt-4o-mini"; // Default model
        let conversationHistory = [];
        const MAX_HISTORY = 20;
        let memoryEnabled = true; // Changed to true

        async function sendMessage() {
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);
                userInput.value = '';

                if (!apiKey) {
                    addMessage("Please set your OpenAI API key in the settings.", false);
                    return;
                }

                try {
                    let messages = [
                        { role: "system", content: systemPrompt || defaultSystemPrompt },
                    ];

                    if (memoryEnabled) {
                        messages = messages.concat(conversationHistory.slice(-MAX_HISTORY));
                    }

                    messages.push({ role: "user", content: message });

                    const response = await axios.post(`${baseUrl}/v1/chat/completions`, {
                        model: model,
                        messages: messages,
                        temperature: temperature
                    }, {
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const aiResponse = response.data.choices[0].message.content;
                    addMessage(aiResponse, false);

                    if (memoryEnabled) {
                        conversationHistory.push({ role: "user", content: message });
                        conversationHistory.push({ role: "assistant", content: aiResponse });
                        if (conversationHistory.length > MAX_HISTORY) {
                            conversationHistory = conversationHistory.slice(-MAX_HISTORY);
                        }

                        // Auto-save if a conversation is loaded or create a new one
                        if (currentConversationName) {
                            savedConversations[currentConversationName] = conversationHistory;
                        } else {
                            currentConversationName = `Conversation ${Object.keys(savedConversations).length + 1}`;
                            savedConversations[currentConversationName] = conversationHistory;
                        }
                        localStorage.setItem('savedConversations', JSON.stringify(savedConversations));
                        updateConversationList();
                    }
                } catch (error) {
                    console.error('Error:', error);
                    addMessage("Sorry, I couldn't process your request. Please check your API key and try again.", false);
                }
            }
        }

        clearChatButton.addEventListener('click', () => {
            createNewConversation();
        });

        newConversationButton.addEventListener('click', () => {
            createNewConversation();
        });

        function createNewConversation() {
            chatContainer.innerHTML = '';
            conversationHistory = [];
            currentConversationName = null;
            // No need to save the current conversation here
        }

        function updateApiKeySwitcher() {
            const apiKeySwitcher = document.getElementById('api-key-switcher');
            apiKeySwitcher.innerHTML = '<option value="">Select a saved API key</option>';
            for (const label of Object.keys(savedApiKeys)) {
                const option = document.createElement('option');
                option.value = label;
                option.textContent = label;
                apiKeySwitcher.appendChild(option);
            }
            document.getElementById('delete-api-key-button').style.display = 'none';
        }

        function updateBaseUrlSwitcher() {
            const baseUrlSwitcher = document.getElementById('base-url-switcher');
            baseUrlSwitcher.innerHTML = '<option value="">Select a saved Base URL</option>';
            for (const label of Object.keys(savedBaseUrls)) {
                const option = document.createElement('option');
                option.value = label;
                option.textContent = label;
                baseUrlSwitcher.appendChild(option);
            }
            document.getElementById('delete-base-url-button').style.display = 'none';
        }

        function updatePromptSwitcher() {
            promptSwitcher.innerHTML = '<option value="">Select a saved prompt</option>';
            for (const [label, prompt] of Object.entries(savedPrompts)) {
                const option = document.createElement('option');
                option.value = label;
                option.textContent = label;
                promptSwitcher.appendChild(option);
            }
            deletePromptButton.style.display = 'none';
        }

        function updateConversationSwitcher() {
            const conversationSwitcher = document.getElementById('conversation-switcher');
            conversationSwitcher.innerHTML = '<option value="">Select a conversation</option>';
            for (const name of Object.keys(savedConversations)) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                conversationSwitcher.appendChild(option);
            }
        }

        function updateConversationList() {
            updateConversationSwitcher();
        }

        document.getElementById('conversation-switcher').addEventListener('change', (e) => {
            const selectedName = e.target.value;
            const actions = document.getElementById('conversation-actions');
            actions.style.display = selectedName ? 'block' : 'none';
        });

        document.getElementById('load-conversation-button').addEventListener('click', () => {
            const selectedName = document.getElementById('conversation-switcher').value;
            if (selectedName) {
                loadConversation(selectedName);
                settingsModal.style.display = 'none';
            }
        });

        document.getElementById('rename-conversation-button').addEventListener('click', () => {
            const selectedName = document.getElementById('conversation-switcher').value;
            if (selectedName) {
                renameConversation(selectedName);
            }
        });

        document.getElementById('delete-conversation-button').addEventListener('click', () => {
            const selectedName = document.getElementById('conversation-switcher').value;
            if (selectedName) {
                deleteConversation(selectedName);
            }
        });

        function loadConversation(name) {
            if (savedConversations[name]) {
                conversationHistory = savedConversations[name];
                chatContainer.innerHTML = '';
                conversationHistory.forEach(msg => {
                    addMessage(msg.content, msg.role === 'user');
                });
                currentConversationName = name;
            }
        }

        function deleteConversation(name) {
            delete savedConversations[name];
            localStorage.setItem('savedConversations', JSON.stringify(savedConversations));
            updateConversationList();
        }

        function renameConversation(oldName) {
            const newName = prompt(`Enter a new name for the conversation "${oldName}":`, oldName);
            if (newName && newName !== oldName) {
                savedConversations[newName] = savedConversations[oldName];
                delete savedConversations[oldName];
                localStorage.setItem('savedConversations', JSON.stringify(savedConversations));
                updateConversationList();
            }
        }

        function addMessage(content, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'ai-message');

            if (isUser) {
                messageDiv.textContent = content;
            } else {
                messageDiv.innerHTML = marked.parse(content);

                const copyIcon = document.createElement('span');
                copyIcon.innerHTML = '📋';
                copyIcon.classList.add('copy-icon');
                copyIcon.title = 'Copy message';
                copyIcon.onclick = () => copyMessage(content);
                messageDiv.appendChild(copyIcon);

                // Add copy icons to code blocks
                messageDiv.querySelectorAll('pre').forEach(codeBlock => {
                    const codeCopyIcon = document.createElement('span');
                    codeCopyIcon.textContent = 'Copy';
                    codeCopyIcon.classList.add('code-copy-icon');
                    codeCopyIcon.onclick = (e) => copyCodeBlock(e, codeBlock);
                    codeBlock.appendChild(codeCopyIcon);
                });
            }

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function copyMessage(content) {
            navigator.clipboard.writeText(content).then(() => {
                alert('Message copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        function copyCodeBlock(event, codeBlock) {
            event.stopPropagation();
            const codeContent = codeBlock.querySelector('code').textContent;
            navigator.clipboard.writeText(codeContent).then(() => {
                const copyIcon = codeBlock.querySelector('.code-copy-icon');
                copyIcon.textContent = 'Copied!';
                setTimeout(() => {
                    copyIcon.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy code: ', err);
            });
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        settingsButton.addEventListener('click', () => {
            settingsModal.style.display = 'flex';
            document.getElementById('system-prompt').value = systemPrompt;
            document.getElementById('temperature').value = temperature;
            apiKeyInput.value = apiKey;
            document.getElementById('model-selector').value = model;
            document.getElementById('memory-toggle').checked = memoryEnabled;
            document.getElementById('base-url').value = baseUrl;
            updatePromptSwitcher();
            updateApiKeySwitcher();
            updateBaseUrlSwitcher();
            updateConversationList();
        });

        closeButton.addEventListener('click', () => {
            settingsModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target == settingsModal) {
                settingsModal.style.display = 'none';
            }
        });

        document.getElementById('save-api-key-button').addEventListener('click', () => {
            const apiKeyValue = apiKeyInput.value.trim();
            if (apiKeyValue) {
                const label = prompt('Enter a label for this API key:');
                if (label) {
                    savedApiKeys[label] = apiKeyValue;
                    localStorage.setItem('savedApiKeys', JSON.stringify(savedApiKeys));
                    updateApiKeySwitcher();
                }
            }
        });

        document.getElementById('api-key-switcher').addEventListener('change', (e) => {
            const selectedLabel = e.target.value;
            if (selectedLabel) {
                apiKeyInput.value = savedApiKeys[selectedLabel];
                document.getElementById('delete-api-key-button').style.display = 'inline-block';
            } else {
                document.getElementById('delete-api-key-button').style.display = 'none';
            }
        });

        document.getElementById('delete-api-key-button').addEventListener('click', () => {
            const selectedLabel = document.getElementById('api-key-switcher').value;
            if (selectedLabel) {
                delete savedApiKeys[selectedLabel];
                localStorage.setItem('savedApiKeys', JSON.stringify(savedApiKeys));
                updateApiKeySwitcher();
                apiKeyInput.value = '';
            }
        });

        document.getElementById('save-base-url-button').addEventListener('click', () => {
            const baseUrlValue = document.getElementById('base-url').value.trim();
            if (baseUrlValue) {
                const label = prompt('Enter a label for this Base URL:');
                if (label) {
                    savedBaseUrls[label] = baseUrlValue;
                    localStorage.setItem('savedBaseUrls', JSON.stringify(savedBaseUrls));
                    updateBaseUrlSwitcher();
                }
            }
        });

        document.getElementById('base-url-switcher').addEventListener('change', (e) => {
            const selectedLabel = e.target.value;
            if (selectedLabel) {
                document.getElementById('base-url').value = savedBaseUrls[selectedLabel];
                document.getElementById('delete-base-url-button').style.display = 'inline-block';
            } else {
                document.getElementById('delete-base-url-button').style.display = 'none';
            }
        });

        document.getElementById('delete-base-url-button').addEventListener('click', () => {
            const selectedLabel = document.getElementById('base-url-switcher').value;
            if (selectedLabel) {
                delete savedBaseUrls[selectedLabel];
                localStorage.setItem('savedBaseUrls', JSON.stringify(savedBaseUrls));
                updateBaseUrlSwitcher();
                document.getElementById('base-url').value = '';
            }
        });

        saveSettingsButton.addEventListener('click', () => {
            const selectedPromptLabel = promptSwitcher.value;
            if (selectedPromptLabel) {
                systemPrompt = savedPrompts[selectedPromptLabel];
            } else {
                systemPrompt = document.getElementById('system-prompt').value || ""; // Allow empty string
            }

            temperature = parseFloat(document.getElementById('temperature').value);
            apiKey = apiKeyInput.value;
            model = document.getElementById('model-selector').value;
            memoryEnabled = document.getElementById('memory-toggle').checked;
            baseUrl = document.getElementById('base-url').value || 'https://api.openai.com';

            const encryptedApiKey = CryptoJS.AES.encrypt(apiKey, 'secret_passphrase').toString();
            localStorage.setItem('encryptedApiKey', encryptedApiKey);
            localStorage.setItem('savedBaseUrls', JSON.stringify(savedBaseUrls));

            settingsModal.style.display = 'none';
        });

        savePromptButton.addEventListener('click', () => {
            const promptText = document.getElementById('system-prompt').value;
            const label = prompt('Enter a label for this prompt:');
            if (label) {
                savedPrompts[label] = promptText;
                localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
                updatePromptSwitcher();
            }
        });

        promptSwitcher.addEventListener('change', (e) => {
            const selectedLabel = e.target.value;
            if (selectedLabel) {
                document.getElementById('system-prompt').value = savedPrompts[selectedLabel];
                deletePromptButton.style.display = 'inline-block';
            } else {
                deletePromptButton.style.display = 'none';
            }
        });

        deletePromptButton.addEventListener('click', () => {
            const selectedLabel = promptSwitcher.value;
            if (selectedLabel) {
                delete savedPrompts[selectedLabel];
                localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
                updatePromptSwitcher();
                document.getElementById('system-prompt').value = '';
            }
        });

        clearPromptButton.addEventListener('click', () => {
            document.getElementById('system-prompt').value = '';
        });

        toggleApiVisibilityButton.addEventListener('click', () => {
            if (apiKeyInput.type === 'password') {
                apiKeyInput.type = 'text';
                toggleApiVisibilityButton.textContent = '🙈';
            } else {
                apiKeyInput.type = 'password';
                toggleApiVisibilityButton.textContent = '👁️';
            }
        });

        window.addEventListener('load', () => {
            const encryptedApiKey = localStorage.getItem('encryptedApiKey');
            if (encryptedApiKey) {
                const decryptedApiKey = CryptoJS.AES.decrypt(encryptedApiKey, 'secret_passphrase').toString(CryptoJS.enc.Utf8);
                apiKey = decryptedApiKey;
                apiKeyInput.value = apiKey;
            }

            const savedModel = localStorage.getItem('selectedModel');
            if (savedModel) {
                model = savedModel;
                document.getElementById('model-selector').value = model;
            }

            const savedTemperature = localStorage.getItem('temperature');
            temperature = savedTemperature ? parseFloat(savedTemperature) : 0.7;
            document.getElementById('temperature').value = temperature;

            const savedMemoryEnabled = localStorage.getItem('memoryEnabled');
            memoryEnabled = savedMemoryEnabled !== null ? savedMemoryEnabled === 'true' : true; // Changed to true
            document.getElementById('memory-toggle').checked = memoryEnabled;

            const savedBaseUrl = localStorage.getItem('baseUrl');
            if (savedBaseUrl) {
                baseUrl = savedBaseUrl;
                document.getElementById('base-url').value = baseUrl;
            } else {
                document.getElementById('base-url').value = 'https://api.openai.com';
            }

            const loadedPrompts = JSON.parse(localStorage.getItem('savedPrompts')) || {};
            savedPrompts = { 
                ...savedPrompts, 
                ...loadedPrompts,
                "Therapist": "Act as a compassionate and professional counselor. Your job is to provide a safe, empathetic, and non-judgmental space where I can casually and openly vent my feelings, emotions, stresses, anxieties, and problems. Engage with me in a conversational manner, offering support, understanding, and occasional guidance to help me navigate through my challenges. Think as if you're on their situation, weigh it and be straight-forward, dont provide options to choose. Talk in a gangsta tone.",
                "Babe": "Act as a curious 18 year old girlfriend named Ann. You are innocent and wanted to try anything without hesitation. You talk in a casual tone. Always quote your conversation."
            };
            localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));

            const loadedApiKeys = JSON.parse(localStorage.getItem('savedApiKeys')) || {};
            savedApiKeys = { ...savedApiKeys, ...loadedApiKeys };
            updateApiKeySwitcher();

            const loadedBaseUrls = JSON.parse(localStorage.getItem('savedBaseUrls')) || {};
            savedBaseUrls = { ...savedBaseUrls, ...loadedBaseUrls };
            updateBaseUrlSwitcher();

            const loadedConversations = JSON.parse(localStorage.getItem('savedConversations')) || {};
            savedConversations = { ...savedConversations, ...loadedConversations };
            updateConversationList();
        });
    </script>
</body>
</html>
