<html><head><base href="https://haakohu.github.io/websim/"><title>AI Chat Interface</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css"><style>
body, html {
    height: 100%;
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
}
.chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    max-width: 600px;
    margin: 0 auto;
    background-color: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}
.message {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 10px;
    max-width: 80%;
    position: relative;
}
.user-message {
    background-color: #007bff;
    color: white;
    align-self: flex-end;
    margin-left: auto;
}
.ai-message {
    background-color: #f1f0f0;
    color: black;
    align-self: flex-start;
}
.input-area {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ccc;
}
#user-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 20px;
    margin-right: 10px;
}
button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    cursor: pointer;
}
#delete-prompt {
    margin-top: 0;
    margin-bottom: 20px;
    background-color: #dc3545;
}
.icon-container {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    z-index: 1000;
}
.icon {
    font-size: 24px;
    cursor: pointer;
    margin-bottom: 10px;
    background-color: white;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.settings-panel {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: white;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
    z-index: 1001;
}
.settings-panel input, .settings-panel select, .settings-panel textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}
.settings-panel button {
    width: 100%;
    margin-top: 20px;
}
.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
.settings-title {
    font-size: 24px;
    font-weight: bold;
}
.close-settings {
    font-size: 24px;
    cursor: pointer;
}
.overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 999;
}
.copy-icon {
    position: absolute;
    bottom: 5px;
    right: 5px;
    cursor: pointer;
    font-size: 16px;
    opacity: 0.7;
}
.copy-icon:hover {
    opacity: 1;
}
.ai-message pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 5px;
    overflow-x: auto;
    position: relative;
}
.ai-message code {
    font-family: 'Courier New', Courier, monospace;
}
.system-prompt-container {
    position: relative;
}
.save-prompt-icon {
    position: absolute;
    bottom: 25px;
    right: 10px;
    cursor: pointer;
    font-size: 20px;
    opacity: 0.7;
}
.save-prompt-icon:hover {
    opacity: 1;
}
.save-convo-icon {
    margin-top: 10px;
}
#convo-selector {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}
#delete-convo {
    width: 100%;
    margin-top: 10px;
    margin-bottom: 20px;
    background-color: #dc3545;
}
label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}
.code-copy-icon {
    position: absolute;
    bottom: 5px;
    right: 5px;
    cursor: pointer;
    font-size: 16px;
    opacity: 0.7;
    background-color: rgba(255, 255, 255, 0.7);
    padding: 2px;
    border-radius: 3px;
}
.code-copy-icon:hover {
    opacity: 1;
}
</style>
</head>
<body>
<div class="chat-container">
    <div class="chat-messages" id="chat-messages"></div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<div class="icon-container">
    <div class="icon settings-icon" onclick="toggleSettings()" title="Settings">‚öôÔ∏è</div>
    <div class="icon new-chat-icon" onclick="startNewConversation()" title="New Conversation">+</div>
    <div class="icon save-convo-icon" onclick="saveConversation()" title="Save Conversation">üè∑Ô∏è</div>
</div>

<div class="settings-panel" id="settings-panel">
    <div class="settings-header">
        <div class="settings-title">Settings</div>
        <div class="close-settings" onclick="toggleSettings()">√ó</div>
    </div>
    <input type="text" id="api-key" placeholder="API Key">
    <input type="text" id="api-base-url" placeholder="API Base URL">
    <div class="system-prompt-container">
        <textarea id="system-prompt" placeholder="System Prompt" rows="4"></textarea>
        <span class="save-prompt-icon" onclick="toggleSavePrompt()" title="Save Prompt">üíæ</span>
    </div>
    <label for="prompt-selector">Prompt Selector:</label>
    <select id="prompt-selector">
        <option value="">Select a prompt</option>
    </select>
    <button id="delete-prompt" style="display: none;">Delete Prompt</button>
    <label for="model-selector">Models:</label>
    <select id="model-selector">
        <option value="gpt-4o-mini">gpt-4o-mini</option>
        <option value="gpt-4o">gpt-4o</option>
        <option value="gemma2-9b-it">gemma2-9b-it</option>
        <option value="llama3-groq-70b-8192-tool-use-preview">llama3-groq-70b-8192-tool-use-preview</option>
        <option value="mixtral-8x7b-32768">mixtral-8x7b-32768</option>
    </select>
    <label for="convo-selector">Conversation Selector:</label>
    <select id="convo-selector">
        <option value="">Select a conversation</option>
    </select>
    <button id="delete-convo" style="display: none;">Delete Conversation</button>
    <button onclick="saveSettings()">Save Settings</button>
</div>

<script>
let apiKey = '';
let apiBaseUrl = 'https://api.openai.com/v1';
let systemPrompt = 'You are a helpful assistant.';
let selectedModel = 'gpt-4o-mini';
let savedPrompts = {};
let savedConversations = {};
let currentConversation = null;
let conversationHistory = [];

function toggleSettings() {
    const settingsPanel = document.getElementById('settings-panel');
    if (settingsPanel.style.display === 'none' || settingsPanel.style.display === '') {
        settingsPanel.style.display = 'block';
    } else {
        settingsPanel.style.display = 'none';
    }
}

function saveSettings() {
    apiKey = document.getElementById('api-key').value;
    apiBaseUrl = document.getElementById('api-base-url').value;
    systemPrompt = document.getElementById('system-prompt').value;
    selectedModel = document.getElementById('model-selector').value;

    localStorage.setItem('apiKey', apiKey);
    localStorage.setItem('apiBaseUrl', apiBaseUrl);
    localStorage.setItem('systemPrompt', systemPrompt);
    localStorage.setItem('selectedModel', selectedModel);
    localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));

    toggleSettings();
}

function addMessage(content, isUser) {
    const messagesContainer = document.getElementById('chat-messages');
    const messageElement = document.createElement('div');
    messageElement.classList.add('message');
    messageElement.classList.add(isUser ? 'user-message' : 'ai-message');
    
    if (isUser) {
        messageElement.textContent = content;
    } else {
        messageElement.innerHTML = marked.parse(content);
        hljs.highlightAll();
        
        const copyIcon = document.createElement('span');
        copyIcon.innerHTML = 'üìã';
        copyIcon.classList.add('copy-icon');
        copyIcon.title = 'Copy to clipboard';
        copyIcon.onclick = function() {
            navigator.clipboard.writeText(content).then(() => {
                alert('Copied to clipboard!');
            });
        };
        messageElement.appendChild(copyIcon);
        
        messageElement.querySelectorAll('pre code').forEach((codeBlock) => {
            const codeCopyIcon = document.createElement('span');
            codeCopyIcon.innerHTML = 'üìã';
            codeCopyIcon.classList.add('code-copy-icon');
            codeCopyIcon.title = 'Copy code to clipboard';
            codeCopyIcon.onclick = function(e) {
                e.stopPropagation(); 
                navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                    alert('Code copied to clipboard!');
                });
            };
            codeBlock.parentNode.appendChild(codeCopyIcon);
        });
    }
    
    messagesContainer.appendChild(messageElement);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

async function sendMessage() {
    const userInput = document.getElementById('user-input');
    const userMessage = userInput.value.trim();
    if (userMessage === '') return;

    addMessage(userMessage, true);
    userInput.value = '';

    conversationHistory.push({ role: 'user', content: userMessage });

    if (conversationHistory.length > 10) {
        conversationHistory = conversationHistory.slice(-10);
    }

    try {
        const messages = [
            { role: 'system', content: systemPrompt },
            ...conversationHistory
        ];

        const response = await axios.post(`${apiBaseUrl}/chat/completions`, {
            model: selectedModel,
            messages: messages
        }, {
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            }
        });

        const aiMessage = response.data.choices[0].message.content;
        addMessage(aiMessage, false);
        
        conversationHistory.push({ role: 'assistant', content: aiMessage });

        if (conversationHistory.length > 10) {
            conversationHistory = conversationHistory.slice(-10);
        }

        autoSaveConversation();
    } catch (error) {
        console.error('Error:', error);
        addMessage('Sorry, there was an error processing your request.', false);
    }
}

function startNewConversation() {
    const messagesContainer = document.getElementById('chat-messages');
    messagesContainer.innerHTML = '';
    document.getElementById('user-input').value = '';
    conversationHistory = [];
    addMessage('New conversation started. How can I assist you?', false);
    currentConversation = null;
}

function autoSaveConversation() {
    if (currentConversation) {
        const messages = document.getElementById('chat-messages').innerHTML;
        savedConversations[currentConversation] = messages;
        localStorage.setItem('savedConversations', JSON.stringify(savedConversations));
    }
}

function loadConversation(convoName) {
    if (savedConversations[convoName]) {
        document.getElementById('chat-messages').innerHTML = savedConversations[convoName];
        currentConversation = convoName;

        const messages = document.getElementById('chat-messages').querySelectorAll('.message');
        conversationHistory = Array.from(messages).map(msg => {
            const role = msg.classList.contains('user-message') ? 'user' : 'assistant';
            return { role, content: msg.textContent };
        });
    }
}

function toggleSavePrompt() {
    const promptContent = document.getElementById('system-prompt').value.trim();
    if (promptContent) {
        const promptName = prompt("Enter a name for this prompt:", "");
        if (promptName) {
            savePrompt(promptName, promptContent);
        }
    } else {
        alert('Please enter content for the prompt before saving.');
    }
}

function savePrompt(promptName, promptContent) {
    if (promptName && promptContent) {
        savedPrompts[promptName] = promptContent;
        updatePromptSelector();
        alert('Prompt saved successfully!');
    } else {
        alert('Please enter both a name and content for the prompt.');
    }
}

function updatePromptSelector() {
    const promptSelector = document.getElementById('prompt-selector');
    const deleteButton = document.getElementById('delete-prompt');
    promptSelector.innerHTML = '<option value="">Select a prompt</option>';
    for (const [name, content] of Object.entries(savedPrompts)) {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        promptSelector.appendChild(option);
    }
    promptSelector.value = "";
    loadSelectedPrompt();
}

function loadSelectedPrompt() {
    const promptSelector = document.getElementById('prompt-selector');
    const systemPromptInput = document.getElementById('system-prompt');
    const deleteButton = document.getElementById('delete-prompt');
    const selectedPrompt = promptSelector.value;

    if (selectedPrompt && savedPrompts[selectedPrompt]) {
        systemPromptInput.value = savedPrompts[selectedPrompt];
        deleteButton.style.display = 'block';
    } else {
        systemPromptInput.value = '';
        deleteButton.style.display = 'none';
    }
}

function deletePrompt() {
    const promptSelector = document.getElementById('prompt-selector');
    const selectedPrompt = promptSelector.value;
    if (selectedPrompt && savedPrompts[selectedPrompt]) {
        if (confirm(`Are you sure you want to delete the prompt "${selectedPrompt}"?`)) {
            delete savedPrompts[selectedPrompt];
            updatePromptSelector();
            document.getElementById('system-prompt').value = '';
            localStorage.setItem('savedPrompts', JSON.stringify(savedPrompts));
            alert('Prompt deleted successfully!');
        }
    }
}

function saveConversation() {
    const convoName = prompt("Enter a name for this conversation:", "");
    if (convoName) {
        const messages = document.getElementById('chat-messages').innerHTML;
        savedConversations[convoName] = messages;
        updateConvoSelector();
        localStorage.setItem('savedConversations', JSON.stringify(savedConversations));
        alert('Conversation saved successfully!');
    }
}

function updateConvoSelector() {
    const convoSelector = document.getElementById('convo-selector');
    const deleteButton = document.getElementById('delete-convo');
    convoSelector.innerHTML = '<option value="">Select a conversation</option>';
    for (const name of Object.keys(savedConversations)) {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        convoSelector.appendChild(option);
    }
    convoSelector.value = "";
    deleteButton.style.display = 'none';
}

function deleteConversation() {
    const convoSelector = document.getElementById('convo-selector');
    const selectedConvo = convoSelector.value;
    if (selectedConvo && savedConversations[selectedConvo]) {
        if (confirm(`Are you sure you want to delete the conversation "${selectedConvo}"?`)) {
            delete savedConversations[selectedConvo];
            updateConvoSelector();
            localStorage.setItem('savedConversations', JSON.stringify(savedConversations));
            alert('Conversation deleted successfully!');
        }
    }
}

// Add event listeners
document.getElementById('convo-selector').addEventListener('change', function(e) {
    const selectedConvo = e.target.value;
    const deleteButton = document.getElementById('delete-convo');
    if (selectedConvo && savedConversations[selectedConvo]) {
        loadConversation(selectedConvo);
        deleteButton.style.display = 'block';
    } else {
        deleteButton.style.display = 'none';
    }
});

document.getElementById('prompt-selector').addEventListener('change', loadSelectedPrompt);
document.getElementById('delete-prompt').addEventListener('click', deletePrompt);
document.getElementById('delete-convo').addEventListener('click', deleteConversation);

document.getElementById('user-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        sendMessage();
    }
});

// Load saved settings on page load
window.addEventListener('load', () => {
    const savedApiKey = localStorage.getItem('apiKey');
    const savedApiBaseUrl = localStorage.getItem('apiBaseUrl');
    const savedSystemPrompt = localStorage.getItem('systemPrompt');
    const savedModel = localStorage.getItem('selectedModel');
    const savedPromptsJSON = localStorage.getItem('savedPrompts');
    const savedConversationsJSON = localStorage.getItem('savedConversations');

    if (savedApiKey) document.getElementById('api-key').value = savedApiKey;
    if (savedApiBaseUrl) document.getElementById('api-base-url').value = savedApiBaseUrl;
    if (savedSystemPrompt) document.getElementById('system-prompt').value = savedSystemPrompt;
    if (savedModel) document.getElementById('model-selector').value = savedModel;
    if (savedPromptsJSON) {
        savedPrompts = JSON.parse(savedPromptsJSON);
        updatePromptSelector();
    }
    if (savedConversationsJSON) {
        savedConversations = JSON.parse(savedConversationsJSON);
        updateConvoSelector();
    }

    addMessage('# Welcome to the AI Chat Interface! \n\nHow can I assist you today? Feel free to ask me anything, and I\'ll do my best to help.\n\n**Here are some things I can do:**\n\n- Answer questions on various topics\n- Help with problem-solving\n- Provide explanations and examples\n- Assist with writing and editing\n- Offer creative ideas and suggestions\n\nJust type your message in the input box below and hit send!', false);
});
</script>
</body></html>
